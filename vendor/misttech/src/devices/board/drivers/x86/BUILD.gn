# Copyright 2025 Mist Tecnologia Ltda. All rights reserved.
# Copyright 2019 The Fuchsia Authors. All rights reserved
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/bind/bind.gni")
import("//build/zircon/zx_library.gni")

group("x86") {
  deps = [ ":platform-bus-x86-driver" ]
}

config("config") {
  visibility = [ ":*" ]

  include_dirs = [
    "include",
    ".",
  ]

  cflags = [ "-Wno-null-pointer-arithmetic" ]
  cflags_c = [ "-fno-strict-aliasing" ]
}

driver_bind_rules("x64-bind") {
  rules = "meta/x64.bind"
  bind_output = "platform-bus-x64.bindbc"
  tests = "meta/bind-tests.json"
  deps = [
    "//sdk/fidl/fuchsia.hardware.platform.bus:fuchsia.hardware.platform.bus_bindlib",
    "//src/devices/bind/fuchsia.intel.platform",
  ]
}

zx_library("platform-bus-x86-driver") {
  configs += [
    "//build/config:all_source",
    "//build/config/fuchsia:enable_zircon_asserts",
  ]

  sources = [
    #"acpi-dev/dev-ec.cc",
    "acpi-nswalk.cc",
    "init.cc",
    "x86.cc",
  ]

  configs += [ ":config" ]
  deps = [
    ":x64-bind",
    "//sdk/banjo/mistos.hardware.pciroot:mistos.hardware.pciroot_banjo_cpp",
    "//src/devices/board/lib/acpi",
    "//src/devices/pci/lib/pci",

    #
    "//vendor/misttech/src/lib/ddk",

    #"//zircon/kernel/lib/init",
    #"//zircon/kernel/lib/kpci",
    "//zircon/kernel/phys:handoff",

    #
    "//vendor/misttech/src/lib/ddk:ddk-deprecated-binding-headers",
    "//vendor/misttech/src/lib/ddktl",
  ]

  configs += [ "//build/config:default_include_dirs" ]
}
