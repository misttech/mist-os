# Copyright 2025 Mist Tecnologia Ltda. All rights reserved.
# Copyright 2019 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/zircon/zx_library.gni")

group("tests") {
  testonly = true
  deps = [ "tests" ]
}

group("drivers") {
  testonly = true
  deps = [ "tests:drivers" ]
}

config("include") {
  include_dirs = [ "include" ]
}

source_set("ddktl") {
  sources = [
    "include/ddktl/device-internal.h",
    "include/ddktl/device.h",
    "include/ddktl/init-txn.h",
    "include/ddktl/resume-txn.h",
    "include/ddktl/suspend-txn.h",
    "include/ddktl/unbind-txn.h",
  ]
  public_configs = [ ":include" ]
  public_deps = [
    # <ddktl/fidl.h> has #include <lib/stdcompat/span.h>
    "//sdk/lib/stdcompat",

    # <ddktl/device.h> has #include <lib/zx/channel.h>.
    "//zircon/system/ulib/zx",

    # <ddktl/device.h> has #include <lib/zx/result.h>.
    "//zircon/system/ulib/zx",

    # <ddktl/fidl.h> has #include <ddk/device.h>
    "//vendor/misttech/src/lib/ddk",
  ]

  deps = [
    "//vendor/misttech/src/lib/ddk",
    "//zircon/system/ulib/zx",
  ]

  #  ________  _________  ________  ________
  # |\   ____\|\___   ___\\   __  \|\   __  \
  # \ \  \___|\|___ \  \_\ \  \|\  \ \  \|\  \
  #  \ \_____  \   \ \  \ \ \  \\\  \ \   ____\
  #   \|____|\  \   \ \  \ \ \  \\\  \ \  \___|
  #     ____\_\  \   \ \__\ \ \_______\ \__\
  #    |\_________\   \|__|  \|_______|\|__|
  #    \|_________|
  #
  # New drivers should be written for DFv2. If you need to target a board stuck on DFv1,
  # it is acceptable to add an entry to this list.
  #
  # To remove items from the allowlist, please send a change to one of the OWNERS of
  # this file to remove an element from the visibility list below.
  #
  # Please allowlist entire directories rather than individual targets as it
  # requires less allowlist churn over time.
  visibility = [
    "//src/devices/board/lib/acpi:*",
    "//src/devices/pci/lib/pci:*",
    "//vendor/misttech/*",
    "//zircon/system/ulib/hwreg/test:*",
    "//zircon/vdso/zx:*",
  ]
}
