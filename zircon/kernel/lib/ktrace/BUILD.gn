# Copyright 2019 The Fuchsia Authors
#
# Use of this source code is governed by a MIT-style
# license that can be found in the LICENSE file or at
# https://opensource.org/licenses/MIT

import("//build/zircon/migrated_targets.gni")

zx_library("ktrace") {
  sources = [ "ktrace.cc" ]
  deps = [
    "//zircon/kernel/hypervisor:headers",
    "//zircon/kernel/lib/boot-options",
    "//zircon/kernel/lib/init",
    "//zircon/kernel/lib/ktl",
    "//zircon/kernel/lib/syscalls:headers",
    "//zircon/kernel/object:headers",
    "//zircon/system/ulib/zircon-internal",
  ]

  public_deps = [
    ":suppress-warning",
    "//src/performance/lib/fxt:headers",
  ]
}

group("suppress-warning") {
  visibility = [ ":*" ]
  public_configs = [ ":suppress-warning.config" ]
}

config("suppress-warning.config") {
  visibility = [
    ":*",

    # TODO(https://fxbug.dev/42121444): Referenced in environment configs.
    "//build/config/*",
    "//sdk/fidl/fuchsia.net/*",
    "//sdk/fidl/mistos.hardware.block.driver/*",
    "//sdk/fidl/mistos.hardware.network.driver/*",
    "//sdk/fidl/mistos.hardware.network/*",
    "//sdk/fidl/zbi:*",
    "//sdk/lib/fit/*",
    "//sdk/lib/iob/*",
    "//sdk/lib/stdcompat/*",
    "//sdk/lib/zbi-format/*",
    "//src/connectivity/ethernet/drivers/virtio/*",
    "//src/connectivity/lib/network-device/buffer_descriptor/*",
    "//src/devices/block/drivers/virtio/*",
    "//src/devices/block/lib/common/*",
    "//src/devices/bind/*",
    "//src/devices/board/lib/acpi/*",
    "//src/devices/bus/lib/virtio/*",
    "//src/lib/ddk/*",
    "//src/lib/ddktl/*",
    "//src/lib/elfldltl/*",
    "//src/lib/llvm-profdata/*",
    "//src/lib/ubsan-custom/*",
    "//src/lib/vmo_store/*",
    "//src/lib/zbitl/*",
    "//src/performance/lib/fxt/*",
    "//third_party/acpica/*",
    "//third_party/lk/*",
    "//third_party/zstd/*",
    "//vendor/google/*",
    "//vendor/misttech/*",
    "//zircon/dev/lib/*",
    "//zircon/kernel/*",
    "//zircon/system/ulib/*",
    "//zircon/third_party/lib/*",
    "//zircon/third_party/ulib/*",
    "//zircon/vdso/*",
  ]
  if (!is_gcc) {
    # Silence warning in Clang about GNU extension used in string_ref.h.
    cflags_cc = [ "-Wno-gnu-string-literal-operator-template" ]
  }
}
