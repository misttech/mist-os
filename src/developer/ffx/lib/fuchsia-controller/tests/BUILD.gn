# Copyright 2023 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/fidl/toolchain.gni")
import("//build/python/python_host_test.gni")
import("//build/testing/host_test_data.gni")

host_test_data("fuchsia_controller_host_test_data") {
  # Needed for SDK inclusion
  testonly = false

  sources = [
    get_label_info("//build/fidl:all_fidl_json($default_toolchain)",
                   "root_out_dir") + "/all_fidl_json.txt",
    get_label_info("//src/developer/ffx/lib/fuchsia-controller/cpp",
                   "root_out_dir") + "/libfuchsia_controller_internal.so",
    get_label_info("//src/developer/ffx/lib/fuchsia-controller/cpp",
                   "root_out_dir") + "/libfidl_codec.so",
  ]
  deps = [
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
    "//src/developer/ffx/lib/fuchsia-controller:lib",
    "//src/developer/ffx/lib/fuchsia-controller/cpp:libfidl_codec",
  ]
}

host_test_data("core_sdk_host_test_data") {
  _sdk_out_dir =
      get_label_info("//sdk:core($default_toolchain)", "root_out_dir")
  sources = [ _sdk_out_dir + "/sdk/exported/core" ]
  deps = [ "//sdk:core($default_toolchain)" ]
}

group("fuchsia_controller_test_data") {
  # Needed for SDK inclusion
  testonly = false

  deps = [
    ":fuchsia_controller_host_test_data",
    "//src/developer/ffx:test_data",
    "//src/developer/ffx/fidl:fuchsia.developer.ffx_host_test_data(${toolchain_variant.base})",
  ]
}

group("fuchsia_controller_fidl_test_data") {
  testonly = true
  deps = [
    "//src/developer/ffx/lib/fuchsia-controller/fidl:fuchsia.controller.othertest_host_test_data(${toolchain_variant.base})",
    "//src/developer/ffx/lib/fuchsia-controller/fidl:fuchsia.controller.test_host_test_data(${toolchain_variant.base})",
    "//src/lib/fidl_codec:fidl-composed_host_test_data(${toolchain_variant.base})",
    "//src/lib/fidl_codec:fidl-sys_host_test_data(${toolchain_variant.base})",
    "//src/lib/fidl_codec:fidl_host_test_data(${toolchain_variant.base})",
  ]
}

python_host_test("fuchsia_controller_ir_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "ir.py"
  libraries = [ "//src/developer/ffx/lib/fuchsia-controller/cpp:fidl_codec" ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_encode_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "encode.py"
  sources = [ "common.py" ]
  libraries = [ "//src/developer/ffx/lib/fuchsia-controller/cpp:fidl_codec" ]
  test_data_deps = [
    ":fuchsia_controller_fidl_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_importing_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "importing.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller/cpp:libfidl_codec",
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
  ]
  test_data_deps = [
    ":fuchsia_controller_fidl_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_errors_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "errors.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_isolate_directory_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "isolate_directory.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_e2e_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "e2e.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  test_data_deps = [
    ":core_sdk_host_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_fidl_client_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "fidl_client.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_channel_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "fidl_channel.py"
  libraries =
      [ "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py" ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_socket_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "socket_tests.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}

python_host_test("fuchsia_controller_fidl_server_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "server.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  test_data_deps = [
    ":fuchsia_controller_fidl_test_data",
    ":fuchsia_controller_test_data",
  ]
}

python_host_test("fuchsia_controller_fidl_common_test") {
  # TODO(https://fxbug.dev/346628306): Resolve mypy errors and enable type checking
  enable_mypy = false
  main_source = "fidl_common.py"
  libraries = [
    "//src/developer/ffx/lib/fuchsia-controller:fidl_bindings",
    "//src/developer/ffx/lib/fuchsia-controller:fuchsia_controller_py",
  ]
  test_data_deps = [ ":fuchsia_controller_test_data" ]
}
